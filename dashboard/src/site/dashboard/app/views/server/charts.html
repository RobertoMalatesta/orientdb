<div class="container-fluid" ng-controller="MetricsMonitorController">
    <div class="row-fluid title">
        <h3>
            <i class="icon-bar-chart"></i>
            {{ 'dashboard.metrics.title' | i18n }}
            <a href="#/help/charts" style="text-decoration: none"><i class="icon-question-sign pull-right"></i></a>
        </h3>
        <div ng-class="testMsgClass" ng-show="testMsg">
            <button type="button" class="close" onclick="$('.alert-setting').hide()">&times;</button>
            {{ testMsg }}
        </div>
    </div>
    <div class="row-fluid">
        <div ng-include src="'views/server/license.html'"></div>
    </div>
    <div class="row-fluid">
        <div class="span4">

            <div class="widget boxed black">
                <div class="widget-title">
                    <div class="widget-caption">
                        <i class="icon-reorder"></i>
                        {{ 'dashboard.metric.saved' | i18n }}
                    </div>
                </div>
                <div class="widget-body available-charts">
                    <table class="table table-striped  table-hover table-condensed table-nocolor">
                        <thead>
                        <tr>
                            <th>{{ 'dashboard.metric.name' | i18n }}</th>
                            <th>
                                <div class="input-append querySearch">
                                    <input class="input-small ng-pristine ng-valid" type="text"
                                           ng-model="searchChart" placeholder="Search">
                               <span class="add-on">
                                    <i class="icon-search"></i>
                                </span>
                                </div>
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-class="{info : $index == currentIdx}" ng-repeat="metr in savedMetrics | filter:searchChart">
                            <td>{{metr.name}}</td>
                            <td class="chart-actions">
                                <div class="pull-right">
                                    <a href="javascript:void(0)" ng-show="!inDashboard[metr['@rid']]"
                                       bs-tooltip="{{ 'metric.addTo' | i18n }}"
                                       data-toggle="top"
                                       data-original-title="{{ 'metric.add' | i18n }}" data-placement="top"
                                       ng-click="addToDashboard(metr)"><i
                                            class="icon-dashboard"></i></a>
                                    <a href="javascript:void(0)" ng-show="inDashboard[metr['@rid']]"
                                       bs-tooltip="{{ 'dashboard.removeFrom' | i18n }}"
                                       data-toggle="top"
                                       data-original-title="{{ 'metric.removeFrom' | i18n }}" data-placement="top"
                                       ng-click="removeFromDashboard(metr)"><i
                                            class="icon-remove-circle"></i></a>
                                    <a href="javascript:void(0)" bs-tooltip="{{ 'metric.edit' | i18n }}"
                                       data-toggle="top"
                                       data-original-title="{{ 'metric.edit' | i18n }}" data-placement="top"
                                       ng-click="selectConfig(metr,$index)"><i
                                            class="icon-edit"></i></a>
                                    <a href="javascript:void(0)" bs-tooltip="{{ 'metric.delete' | i18n }}"
                                       data-toggle="top"
                                       data-original-title="{{ 'metric.delete' | i18n }}" data-placement="top"
                                       ng-click="deleteConfig(metr)"><i
                                            class="icon-trash"></i></a>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

            </div>

        </div>
        <div class="span8">
            <div class="widget  boxed black">
                <div class="widget-title">
                    <div class="widget-caption">
                        <i class="icon-reorder"></i>
                        {{ 'dashboard.metric.detail' | i18n }}
                    </div>
                    <div class="actions">
                        <button class="btn btn-inverse pull-right"
                                href="javascript:void(0)" ng-disabled="metricForm.$invalid"
                                ng-click="saveMetricConfig()">
                            <i class="icon-save"> {{ 'dashboard.metric.save' | i18n }}</i>
                        </button>
                        <a class="btn btn-inverse  pull-right"
                           href="javascript:void(0)" ng-click="newMetricConfig()">
                            <i class="icon-plus-sign-alt"> {{ 'dashboard.metric.create' | i18n }}</i>
                        </a>
                    </div>
                </div>
                <div class="widget-body ">
                    <form class="form-horizontal well" name="metricForm">
                        <div class="control-group">
                            <label class="control-label" for="inputName">{{ 'dashboard.metric.name' | i18n
                                }}</label>

                            <div class="controls">
                                <input type="text" id="inputName" class="input-large" required placeholder="Name"
                                       ng-model="selectedConfig.name">
                            </div>

                        </div>
                        <div class="control-group">
                            <label class="control-label" for="inputName">{{ 'dashboard.metric.server' | i18n
                                }}</label>

                            <div class="controls">
                                <select ng-model="selectedConfig.server" required class="input-large"
                                        ng-options="s['@rid'] as s.name for s in servers"
                                        data-placeholder="Pick a Server">

                                </select>
                                <button class="btn pull-right" ng-click="addConfig()"><span
                                        class="icon-plus"></span>
                                </button>
                            </div>

                        </div>
                        <div class="control-group" ng-repeat="conf in selectedConfig.config">
                            <label class="control-label">{{ 'dashboard.metrics' | i18n }}</label>

                            <div class="controls">
                                <select ng-model="conf.name" required class="span6"
                                        data-placeholder="Pick a Metric">
                                    <option ng-repeat="met in metrics" ng-selected="met.name == conf.name"
                                            value="{{ met.name }}">{{ met.name }}
                                    </option>
                                </select>
                                <select ng-model="conf.field"
                                        required class="span4"
                                        data-placeholder="Pick a Metric">
                                    <option ng-repeat="f in fields | mvalue:mType:conf.name"
                                            ng-selected="f == conf.field" value="{{ f }}">{{ f }}
                                    </option>
                                </select>

                                <div class="pull-right">
                                    <button class="btn" ng-click="removeMetric(met)"><span
                                            class="icon-trash"></span>
                                    </button>
                                </div>
                            </div>

                        </div>

                    </form>
                </div>

            </div>
        </div>
    </div>


    <div metricchart="selectedConfig" chartheight="500"></div>

</div>
